<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeGateway - Developer Portal</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { 
            --primary: #3b82f6;   /* Pokemon Blue (Button) */
            --danger: #ef4444;    /* Red */
            --dark: #1e293b; 
            --light: #f1f5f9; 
            --sidebar: #dc2626;   /* POKEDEX RED */
            --sidebar-active: #991b1b; /* Darker Red for active */
            --card-bg: #ffffff; 
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: var(--light); color: #333; height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }

        /* AUTH & LAYOUT */
        .full-screen { display: flex; height: 100vh; width: 100vw; justify-content: center; align-items: center; background: #f1f5f9; }
        .auth-card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; border-top: 5px solid var(--sidebar); }
        
        /* INPUT & BUTTONS */
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; font-size: 0.85rem; margin-bottom: 5px; color: #64748b; font-weight: 600; }
        .input-group input { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; outline: none; transition: 0.2s; }
        .input-group input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.2s; letter-spacing: 0.5px; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3); }
        .btn-primary:hover { background: #2563eb; transform: translateY(-1px); }
        .link { color: var(--primary); cursor: pointer; font-weight: 700; }

        /* DASHBOARD LAYOUT */
        .dashboard-layout { display: flex; width: 100vw; height: 100vh; }
        
        /* SIDEBAR POKEDEX STYLE */
        .sidebar { width: 280px; background: var(--sidebar); color: white; padding: 25px 20px; display: flex; flex-direction: column; box-shadow: 4px 0 15px rgba(0,0,0,0.1); z-index: 10; }
        
        .brand { 
            font-size: 1.6rem; 
            font-weight: 800; 
            margin-bottom: 40px; 
            color: #fff; 
            gap: 15px; 
            display: flex; 
            align-items: center; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .pokeball-logo { width: 40px; height: 40px; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2)); animation: spin 10s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .menu-item { padding: 14px 15px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; color: rgba(255,255,255,0.8); display: flex; gap: 12px; align-items: center; font-weight: 600; transition: 0.2s; }
        .menu-item:hover { background: rgba(0,0,0,0.1); color: white; }
        .menu-item.active { background: var(--dark); color: #fbbf24; /* Kuning Pikachu */ box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .menu-item i { width: 25px; text-align: center; }

        .main-content { flex: 1; padding: 30px; overflow-y: auto; background: #f8fafc; }
        .card { background: var(--card-bg); border-radius: 16px; padding: 30px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #e2e8f0; }
        .api-key-box { background: #f1f5f9; padding: 15px; border-radius: 10px; font-family: 'Consolas', monospace; border: 2px dashed #cbd5e1; margin: 20px 0; display: flex; justify-content: space-between; align-items: center; color: #334155; font-weight: bold; }

        /* VISUAL POKEMON STYLE */
        .poke-visual-container { display: flex; gap: 40px; align-items: flex-start; flex-wrap: wrap; }
        .visual-left { flex: 1; min-width: 250px; text-align: center; display: flex; flex-direction: column; align-items: center; background: radial-gradient(circle at center, #f3f4f6 0%, #ffffff 70%); border-radius: 50%; padding: 20px; }
        .visual-right { flex: 2; min-width: 300px; padding-top: 10px; }
        
        .poke-img { width: 200px; height: 200px; object-fit: contain; filter: drop-shadow(0 15px 25px rgba(0,0,0,0.2)); transition: transform 0.3s; }
        .poke-img:hover { transform: scale(1.1) rotate(5deg); }
        
        .type-badges { margin-top: 15px; display: flex; gap: 8px; justify-content: center; }
        .badge { padding: 6px 16px; border-radius: 20px; font-size: 0.8rem; font-weight: 800; text-transform: uppercase; color: white; background: #94a3b8; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        /* STATS TABLE */
        .stat-table { width: 100%; font-size: 0.9rem; border-collapse: separate; border-spacing: 0 10px; }
        .stat-label { width: 80px; color: #64748b; font-weight: 700; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.5px; }
        .stat-val { width: 40px; text-align: right; font-weight: 700; color: #1e293b; }
        .stat-bar-cell { padding-left: 15px; width: 100%; }
        .stat-track { height: 10px; background-color: #e2e8f0; border-radius: 5px; width: 100%; overflow: hidden; box-shadow: inset 0 1px 2px rgba(0,0,0,0.05); }
        .stat-fill { height: 100%; border-radius: 5px; width: 0%; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* COLORS */
        .bar-low { background: #ef4444; } .bar-mid { background: #facc15; } .bar-high { background: #22c55e; } .bar-top { background: #06b6d4; }
        .total-row { border-top: 2px solid #f1f5f9; font-weight: 800; padding-top: 15px; margin-top: 10px; display: flex; justify-content: space-between; font-size: 1.1rem; color: var(--dark); }

        /* LIST CARD STYLE */
        .custom-item-wrapper { border: 1px solid #e2e8f0; border-radius: 16px; padding: 25px; margin-bottom: 25px; background: #fff; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .custom-item-wrapper:hover { border-color: var(--primary); transform: translateY(-2px); }

        pre { background: #1e293b; color: #a5b4fc; padding: 20px; border-radius: 12px; overflow-x: auto; font-size: 0.85rem; font-family: 'Consolas', monospace; border: 1px solid #334155; }
        .json-key { color: #38bdf8; } .json-string { color: #a3e635; } .json-number { color: #f472b6; }
    </style>
</head>
<body>

    <div id="loginSection" class="full-screen">
        <div class="auth-card">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Pok%C3%A9_Ball_icon.svg" style="width: 60px; margin-bottom: 15px;">
            <h2 style="margin-bottom: 5px;">Trainer Login</h2>
            <p style="color: #64748b; margin-bottom: 25px;">Masuk ke Portal Developer</p>
            
            <div class="input-group"><label>Email</label><input type="email" id="email" value="admin@dev.com"></div>
            <div class="input-group"><label>Password</label><input type="password" id="password" value="123"></div>
            <button class="btn btn-primary" onclick="login()">Login</button>
            <p style="margin-top: 20px; font-size: 0.9rem;">Belum punya akun? <span class="link" onclick="switchAuth('register')">Daftar</span></p>
        </div>
    </div>

    <div id="registerSection" class="full-screen hidden">
        <div class="auth-card">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Pok%C3%A9_Ball_icon.svg" style="width: 60px; margin-bottom: 15px;">
            <h2 style="margin-bottom: 25px;">Daftar Trainer Baru</h2>
            <div class="input-group"><label>Company / Team Name</label><input type="text" id="regCompany"></div>
            <div class="input-group"><label>Email</label><input type="email" id="regEmail"></div>
            <div class="input-group"><label>Password</label><input type="password" id="regPassword"></div>
            <button class="btn btn-primary" onclick="register()">Register</button>
            <p style="margin-top: 20px; font-size: 0.9rem;">Sudah punya akun? <span class="link" onclick="switchAuth('login')">Login</span></p>
        </div>
    </div>

    <div id="dashboardSection" class="dashboard-layout hidden">
        <aside class="sidebar">
            <div class="brand">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Pok%C3%A9_Ball_icon.svg" class="pokeball-logo">
                PokeGateway
            </div>
            
            <nav>
                <div class="menu-item active" onclick="navigate('home')" id="nav-home">
                    <i class="fa-solid fa-house"></i> Dashboard
                </div>
                <div class="menu-item" onclick="navigate('playground')" id="nav-playground">
                    <i class="fa-solid fa-magnifying-glass"></i> Pokedex Global
                </div>
                <div class="menu-item" onclick="navigate('database')" id="nav-database">
                    <i class="fa-solid fa-server"></i> My Data
                </div>
            </nav>
            <div style="margin-top: auto; padding-top:20px; border-top:1px solid rgba(255,255,255,0.2);">
                <div class="menu-item" onclick="logout()" style="color:#fecaca;">
                    <i class="fa-solid fa-right-from-bracket"></i> Logout
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div id="view-home">
                <h1 style="margin-bottom:20px; font-weight: 800; color: #1e293b;">Dashboard Overview</h1>
                <div class="card">
                    <h3>üîë API Key Anda</h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-top: 5px;">Gunakan key ini di header <code>x-api-key</code> request Anda.</p>
                    <div class="api-key-box">
                        <span id="displayKey">Loading...</span>
                        <i class="fa-solid fa-copy" style="cursor:pointer; color:var(--primary)" onclick="copyKey()"></i>
                    </div>
                    <button class="btn btn-primary" style="width:auto" onclick="generateKey()">
                        <i class="fa-solid fa-rotate"></i> Generate New Key
                    </button>
                </div>
            </div>

            <div id="view-playground" class="hidden">
                <h1 style="margin-bottom:20px; font-weight: 800; color: #1e293b;">Pokedex Global</h1>
                <div class="card">
                    <h3>üåç Cari Pokemon (Global API)</h3>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <input type="text" id="globalInput" placeholder="Nama Pokemon (ex: charizard, lucario)" style="flex:1;">
                        <button class="btn btn-primary" style="width: 120px;" onclick="testGlobal()">Search</button>
                    </div>
                </div>

                <div id="visualResult" class="card hidden" style="border-top: 5px solid var(--primary);">
                    <div class="poke-visual-container">
                        <div class="visual-left">
                            <img id="v-img" src="" class="poke-img" data-normal="" data-shiny="">
                            
                            <div id="shinyControl" style="margin-top: 15px;">
                                <label style="cursor:pointer; font-size: 0.8rem; font-weight: 700; user-select: none; background: #fff; padding: 8px 15px; border-radius: 20px; border: 2px solid #e2e8f0; display: inline-block; color: #475569;">
                                    <input type="checkbox" id="shinyToggle" onchange="toggleShiny()"> ‚ú® Shiny Mode
                                </label>
                            </div>

                            <h2 id="v-name" style="text-transform: capitalize; margin-top: 15px; font-size: 2rem; font-weight: 800;">Name</h2>
                            <div id="v-types" class="type-badges"></div>
                            <p style="font-size:0.8rem; color:#64748b; margin-top:10px; font-weight: 600;">ID: #<span id="v-id">0</span></p>
                        </div>
                        
                        <div class="visual-right">
                            <h3 style="margin-bottom:20px; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px;">Base Stats</h3>
                            <table class="stat-table">
                                <tbody id="stat-container"></tbody>
                            </table>
                            <div class="total-row"><span>Total Stats</span><span id="v-total" style="font-size: 1.3rem; color: var(--primary);">0</span></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h4>Response JSON (Raw)</h4>
                    <pre id="jsonOutput">Menunggu request...</pre>
                </div>
            </div>

            <div id="view-database" class="hidden">
                <h1 style="margin-bottom:20px; font-weight: 800; color: #1e293b;">My Custom Data</h1>
                
                <div class="card" id="formCard" style="border-top: 5px solid #10b981;">
                    <h3 id="formTitle">‚ûï Tambah Pokemon Baru</h3>
                    <input type="hidden" id="editId">

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div class="input-group">
                            <label>Nama Pokemon</label>
                            <input type="text" id="customName" placeholder="Contoh: Mecha-Pikachu">
                        </div>
                        <div class="input-group">
                            <label>Tipe</label>
                            <input type="text" id="customType" placeholder="Contoh: Steel/Electric">
                        </div>
                    </div>
                    <div class="input-group">
                         <label>URL Gambar (Sprite)</label>
                         <input type="text" id="customSprite" placeholder="https://...">
                         <p style="font-size: 0.75rem; color: #64748b; margin-top: 5px;">*Paste link gambar (Direct Image Link) dari internet.</p>
                    </div>
                    
                    <h4 style="margin-top:20px; margin-bottom:15px; font-size:0.9rem; color:#64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">Base Stats</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <div class="input-group"><label>HP</label><input type="number" id="inpHp" placeholder="50"></div>
                        <div class="input-group"><label>Attack</label><input type="number" id="inpAtk" placeholder="50"></div>
                        <div class="input-group"><label>Defense</label><input type="number" id="inpDef" placeholder="50"></div>
                        <div class="input-group"><label>Sp. Atk</label><input type="number" id="inpSpA" placeholder="50"></div>
                        <div class="input-group"><label>Sp. Def</label><input type="number" id="inpSpD" placeholder="50"></div>
                        <div class="input-group"><label>Speed</label><input type="number" id="inpSpd" placeholder="50"></div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button id="btnSave" class="btn btn-primary" onclick="saveCustom()" style="background: #10b981;">Simpan ke Database</button>
                        <button id="btnCancel" class="btn hidden" style="background: #64748b; color: white;" onclick="cancelEdit()">Batal</button>
                    </div>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>üìÇ Data Tersimpan</h3>
                        <button class="btn btn-primary" style="width: auto; padding: 8px 20px; font-size:0.85rem;" onclick="listCustom()">
                            <i class="fa-solid fa-rotate-right"></i> Refresh List
                        </button>
                    </div>
                    
                    <div id="customListContainer"></div>

                    <h4 style="margin-top: 30px; font-size: 0.8rem; color: #64748b;">Raw JSON Data:</h4>
                    <pre id="dbOutput">Klik refresh untuk melihat data...</pre>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API = 'http://localhost:3000';
        let token = localStorage.getItem('token');
        if(token) { switchAuth('dashboard'); loadKey(); }

        function switchAuth(page) {
            ['loginSection', 'registerSection', 'dashboardSection'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(page + 'Section').classList.remove('hidden');
        }
        function navigate(view) {
            ['home', 'playground', 'database'].forEach(v => {
                document.getElementById('view-'+v).classList.add('hidden');
                document.getElementById('nav-'+v).classList.remove('active');
            });
            document.getElementById('view-'+view).classList.remove('hidden');
            document.getElementById('nav-'+view).classList.add('active');
        }
        function logout() { localStorage.removeItem('token'); location.reload(); }
        function copyKey() { navigator.clipboard.writeText(document.getElementById('displayKey').innerText); alert("Key Copied!"); }
        async function loadKey() { try { const res = await fetch(`${API}/dashboard/my-key?token=${token}`); const data = await res.json(); document.getElementById('displayKey').innerText = data.key_string || "Belum ada key"; } catch(e) { logout(); } }
        async function login() { const email = document.getElementById('email').value; const password = document.getElementById('password').value; try { const res = await fetch(`${API}/auth/login`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email, password}) }); const data = await res.json(); if(data.token) { localStorage.setItem('token', data.token); token=data.token; switchAuth('dashboard'); loadKey(); } else { alert(data.error); } } catch(e) { alert("Server Error. Pastikan Backend jalan di port 3000."); } }
        async function register() { const company = document.getElementById('regCompany').value; const email = document.getElementById('regEmail').value; const pass = document.getElementById('regPassword').value; try { const res = await fetch(`${API}/auth/register`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email, password:pass, company_name:company}) }); const data = await res.json(); if(data.status==='success') { alert("Sukses!"); switchAuth('login'); } else { alert(data.error); } } catch(e) { alert("Server Error"); } }
        async function generateKey() { await fetch(`${API}/dashboard/generate-key`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({token}) }); loadKey(); }

        async function testGlobal() {
            const name = document.getElementById('globalInput').value;
            const key = document.getElementById('displayKey').innerText;
            const output = document.getElementById('jsonOutput');
            const visual = document.getElementById('visualResult');
            output.innerHTML = "Loading...";
            try {
                const res = await fetch(`${API}/v1/pokemon/${name.toLowerCase()}`, { headers: { 'x-api-key': key } });
                const data = await res.json();
                output.innerHTML = syntaxHighlight(data);
                if(!data.error) {
                    visual.classList.remove('hidden');
                    const img = document.getElementById('v-img');
                    img.dataset.normal = data.sprite || 'https://via.placeholder.com/150';
                    img.dataset.shiny = data.sprite_shiny || data.sprite;
                    img.src = img.dataset.normal;
                    document.getElementById('shinyToggle').checked = false;
                    document.getElementById('shinyControl').classList.remove('hidden');
                    document.getElementById('v-name').innerText = data.name;
                    document.getElementById('v-id').innerText = data.id || '?';
                    document.getElementById('v-total').innerText = data.total_stats || 0;
                    document.getElementById('v-types').innerHTML = createTypesHTML(data.types || [data.type]);
                    document.getElementById('stat-container').innerHTML = createStatsHTML(data.stats);
                } else { visual.classList.add('hidden'); alert(data.error); }
            } catch(e) { output.innerText = "Error: " + e.message; }
        }
        function toggleShiny() { const cb = document.getElementById('shinyToggle'); const img = document.getElementById('v-img'); img.src = cb.checked ? img.dataset.shiny : img.dataset.normal; }

        async function saveCustom() {
            const editId = document.getElementById('editId').value;
            const key = document.getElementById('displayKey').innerText;
            const body = {
                name: document.getElementById('customName').value,
                type: document.getElementById('customType').value,
                sprite: document.getElementById('customSprite').value,
                hp: document.getElementById('inpHp').value,
                attack: document.getElementById('inpAtk').value,
                defense: document.getElementById('inpDef').value,
                sp_attack: document.getElementById('inpSpA').value,
                sp_defense: document.getElementById('inpSpD').value,
                speed: document.getElementById('inpSpd').value
            };

            let url = `${API}/v1/pokemon`;
            let method = 'POST';
            if(editId) { url = `${API}/v1/pokemon/${editId}`; method = 'PUT'; }

            try {
                const res = await fetch(url, { method: method, headers: { 'Content-Type': 'application/json', 'x-api-key': key }, body: JSON.stringify(body) });
                const data = await res.json();
                alert(data.message || data.error);
                if(data.status === 'success') { cancelEdit(); listCustom(); }
            } catch(e) { alert("Error saving"); }
        }

        function prepareEdit(id, name, type, sprite, hp, atk, def, spa, spd, spe) {
            document.getElementById('editId').value = id;
            document.getElementById('customName').value = name;
            document.getElementById('customType').value = type;
            document.getElementById('customSprite').value = sprite;
            document.getElementById('inpHp').value = hp;
            document.getElementById('inpAtk').value = atk;
            document.getElementById('inpDef').value = def;
            document.getElementById('inpSpA').value = spa;
            document.getElementById('inpSpD').value = spd;
            document.getElementById('inpSpd').value = spe;

            document.getElementById('formTitle').innerText = "‚úèÔ∏è Edit Pokemon";
            document.getElementById('btnSave').innerText = "Update Data";
            document.getElementById('btnCancel').classList.remove('hidden');
            document.getElementById('formCard').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelEdit() {
            document.getElementById('editId').value = '';
            document.getElementById('customName').value = '';
            document.getElementById('customType').value = '';
            document.getElementById('customSprite').value = '';
            ['inpHp','inpAtk','inpDef','inpSpA','inpSpD','inpSpd'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('formTitle').innerText = "‚ûï Tambah Pokemon Baru";
            document.getElementById('btnSave').innerText = "Simpan ke Database";
            document.getElementById('btnCancel').classList.add('hidden');
        }

        async function listCustom() {
            const key = document.getElementById('displayKey').innerText;
            const output = document.getElementById('dbOutput');
            const listContainer = document.getElementById('customListContainer');
            
 
            listContainer.innerHTML = `
                <div style="text-align:center; padding:40px; color:#64748b;">
                    <i class="fa-solid fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i>
                    <p>Sedang mengambil data...</p>
                </div>`;
            output.innerText = "Loading...";

            try {
                const res = await fetch(`${API}/v1/custom-pokemon`, { headers: { 'x-api-key': key } });
     
                if (!res.ok) throw new Error(`Server Error: ${res.status} ${res.statusText}`);

                const data = await res.json();
                output.innerHTML = syntaxHighlight(data); 

            
                listContainer.innerHTML = ""; 

                if(data.data && data.data.length > 0) {
                    data.data.forEach(poke => { 
                        listContainer.innerHTML += createCardHTML(poke); 
                    });
                } else {
                    listContainer.innerHTML = `
                        <div style="text-align:center; padding: 40px; border: 2px dashed #cbd5e1; border-radius: 12px; background: #f8fafc;">
                            <img src="https://cdn-icons-png.flaticon.com/512/7486/7486744.png" style="width: 80px; opacity: 0.5; margin-bottom: 15px;">
                            <h4 style="color: #475569; margin-bottom: 5px;">Belum ada Pokemon</h4>
                            <p style="color: #94a3b8; font-size: 0.9rem;">Data kamu masih kosong. Yuk tambah pokemon baru di form atas!</p>
                        </div>
                    `;
                }

            } catch(e) { 
                listContainer.innerHTML = `
                    <div style="text-align:center; padding: 20px; background: #fee2e2; border-radius: 8px; color: #b91c1c; border: 1px solid #fecaca;">
                        <i class="fa-solid fa-triangle-exclamation"></i> <strong>Gagal Memuat Data</strong><br>
                        <small>${e.message}</small>
                    </div>
                `;
                output.innerText = "Error: " + e.message; 
            }
        }

        async function deletePokemon(id) {
            if(!confirm("Yakin ingin melepas Pokemon ini?")) return;
            const key = document.getElementById('displayKey').innerText;
            try {
                const res = await fetch(`${API}/v1/pokemon/${id}`, { method: 'DELETE', headers: { 'x-api-key': key } });
                const data = await res.json();
                alert(data.message || data.error);
                if(data.status === 'success') listCustom();
            } catch(e) { alert("Server error"); }
        }

        function createCardHTML(data) {
            let actionBtns = '';
            if (data.can_delete) {
                const safeName = (data.name || '').replace(/'/g, "\\'");
                const safeType = (data.type || '').replace(/'/g, "\\'");
                const safeSprite = (data.sprite || '').replace(/'/g, "\\'");
                
                actionBtns = `
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button onclick="prepareEdit(${data.id}, '${safeName}', '${safeType}', '${safeSprite}', ${data.stats.hp}, ${data.stats.attack}, ${data.stats.defense}, ${data.stats.sp_attack}, ${data.stats.sp_defense}, ${data.stats.speed})" 
                        style="background: #3b82f6; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; flex: 1; font-weight:bold;">
                        <i class="fa-solid fa-pen"></i> Edit
                    </button>
                    <button onclick="deletePokemon(${data.id})" 
                        style="background: #ef4444; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; flex: 1; font-weight:bold;">
                        <i class="fa-solid fa-trash"></i> Release
                    </button>
                </div>`;
            }
            let ownerInfo = !data.is_mine ? `<span style="font-size:0.75rem; background:#f1f5f9; color:#475569; padding:4px 10px; border-radius:15px; display:inline-block; margin-top:10px; font-weight:600;">Data Milik User Lain</span>` : '';

            return `
            <div class="custom-item-wrapper">
                <div class="poke-visual-container">
                    <div class="visual-left">
                        <img src="${data.sprite || 'https://upload.wikimedia.org/wikipedia/commons/5/53/Pok%C3%A9_Ball_icon.svg'}" class="poke-img" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/5/53/Pok%C3%A9_Ball_icon.svg'">
                        <h2 style="text-transform: capitalize; margin-top: 15px; font-size: 1.6rem; font-weight:800;">${data.name}</h2>
                        <div class="type-badges">${createTypesHTML(data.types || [data.type])}</div>
                        <div style="margin-top:10px; width: 100%;">${ownerInfo}${actionBtns}</div>
                    </div>
                    <div class="visual-right">
                        <table class="stat-table"><tbody>${createStatsHTML(data.stats)}</tbody></table>
                        <div class="total-row"><span>Total Stats</span><span style="font-size: 1.2rem; color:#dc2626;">${data.total_stats || 0}</span></div>
                    </div>
                </div>
            </div>`;
        }

        function createTypesHTML(typesArr) { const types = Array.isArray(typesArr) ? typesArr : [typesArr]; return types.map(t => `<span class="badge" style="background-color:${getTypeColor(t)}">${t}</span>`).join(''); }
        function createStatsHTML(stats) { let html = ''; const labels = { hp: 'HP', attack: 'Attack', defense: 'Defense', sp_attack: 'Sp. Atk', sp_defense: 'Sp. Def', speed: 'Speed' }; for(const [key, val] of Object.entries(stats)) { let barClass = 'bar-low'; if(val >= 100) barClass = 'bar-top'; else if(val >= 80) barClass = 'bar-high'; else if(val >= 50) barClass = 'bar-mid'; const width = Math.min((val / 200) * 100, 100) + '%'; html += `<tr><td class="stat-label">${labels[key] || key}</td><td class="stat-val">${val}</td><td class="stat-bar-cell"><div class="stat-track"><div class="stat-fill ${barClass}" style="width: ${width}"></div></div></td></tr>`; } return html; }
        function getTypeColor(type) { 
            const colors = { 
                fire:'#f87171', water:'#60a5fa', grass:'#4ade80', electric:'#facc15', psychic:'#f472b6', normal:'#94a3b8', ice:'#818cf8', dragon:'#8b5cf6', dark:'#475569', fairy:'#fb7185', fighting:'#fb923c', rock:'#a8a29e', ghost:'#7c3aed', ground:'#d97706', bug:'#84cc16', steel:'#94a3b8', poison:'#c084fc', flying:'#818cf8' 
            }; 
            return colors[type.toLowerCase()] || '#64748b'; 
        }
        function syntaxHighlight(json) { if (typeof json != 'string') json = JSON.stringify(json, undefined, 2); return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) { var cls = 'json-number'; if (/^"/.test(match)) { if (/:$/.test(match)) cls = 'json-key'; else cls = 'json-string'; } else if (/true|false/.test(match)) cls = 'json-boolean'; else if (/null/.test(match)) cls = 'json-null'; return '<span class="' + cls + '">' + match + '</span>'; }); }
    </script>
</body>
</html>